<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AIA Pro Achiever 3.0 - Strategic Wealth Advisor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 15px; background-color: #f4f7f6; color: #333; font-size: 13px; }
        #authOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2c3e50; display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .auth-box { background: white; padding: 40px; border-radius: 12px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .card { max-width: 1250px; margin: auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .header-section { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 2px solid #d31145; padding-bottom: 10px; margin-bottom: 20px; }
        .confidential-tag { color: #d31145; font-weight: bold; font-size: 10px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .btn-group { display: flex; gap: 10px; }
        .btn-pdf { background: #d31145; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold; }
        .btn-clear { background: #7f8c8d; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold; }
        .input-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .setup-box { background: #fff; border: 1px solid #ddd; padding: 15px; border-radius: 6px; }
        .market-box { background: #fff5f6; border: 1px solid #d31145; padding: 15px; border-radius: 6px; }
        .input-group { margin-bottom: 12px; display: flex; flex-direction: column; }
        label { font-weight: bold; margin-bottom: 5px; font-size: 0.9em; color: #d31145; }
        input, select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95em; }
        .check-group { display: flex; align-items: center; gap: 8px; margin-top: 5px; font-weight: bold; cursor: pointer; }
        .stats-bar { display: grid; gap: 10px; margin-bottom: 20px; }
        .stat-card { background: #2c3e50; color: white; padding: 12px; border-radius: 6px; text-align: center; border-bottom: 3px solid #ffbc00; }
        .stat-val { font-size: 1.1em; font-weight: bold; color: #ffbc00; display: block; }
        .cn-sub { font-size: 0.75em; display: block; opacity: 0.8; font-weight: normal; margin-bottom: 2px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 10.5px; }
        th { background: #d31145; color: white; padding: 8px 5px; text-align: left; vertical-align: top; line-height: 1.3; }
        td { padding: 6px 5px; border-bottom: 1px solid #eee; }
        .total-row { background: #fdf2f4; font-weight: bold; }
        .return-col { background-color: #f0fdf4; color: #166534; font-weight: bold; text-align: center; }
        .comp-col { background-color: #f8fafc; color: #64748b; font-style: italic; }
        .hidden { display: none !important; }
        .disclaimer { margin-top: 25px; padding: 15px; background: #f9f9f9; border: 1px solid #ddd; font-size: 10.5px; color: #444; text-align: center; line-height: 1.5; }
    </style>
</head>
<body onload="init()">

<div id="authOverlay">
    <div class="auth-box">
        <h2 style="color:#d31145; margin-top:0;">Wesion Secure Access</h2>
        <p>Please enter the password to view the Strategy Tool</p>
        <input type="password" id="passInput" placeholder="Password" style="width: 200px; padding: 10px; margin-bottom: 20px; text-align: center; border: 1px solid #ddd; border-radius: 4px;">
        <br>
        <button class="btn-pdf" onclick="checkPass()">Unlock Access</button>
        <p id="errorMsg" style="color:red; font-size:0.85em; margin-top:10px; visibility:hidden;">Incorrect password.</p>
    </div>
</div>

<div class="card hidden" id="mainCard">
    <div id="pdfContent">
        <div class="header-section">
            <div>
                <div class="confidential-tag">For Internal Consultant Use Only</div>
                <h1 style="color:#d31145; margin:0; font-size: 1.8em;">AIA Pro Achiever 3.0</h1>
                <div class="gen-date">Analysis Date: January 2026</div>
                <p style="margin:10px 0 0 0;">
                    <span class="cn-sub">准备用于 / Prepared for:</span>
                    <input type="text" id="clientName" value="VALUED CLIENT" style="border:none; border-bottom:1px solid #ccc; font-weight:bold; color:#333; width:180px; font-size:1.1em;">
                </p>
            </div>
            <div class="no-print btn-group">
                <button class="btn-clear" onclick="clearData()">Clear All</button>
                <button class="btn-pdf" onclick="downloadPDF()">Download PDF Report</button>
            </div>
        </div>

        <div class="input-container no-print">
            <div class="setup-box">
                <label class="cn-sub">1. 保单设置 / Policy Parameters</label>
                <div class="input-group"><label>年缴保费 / Annual Premium (S$)</label><input type="number" id="pIn" value="12000" oninput="calc()"></div>
                <div class="input-group"><label>受保人年龄 / Age (ALB)</label><input type="number" id="ageIn" value="40" oninput="calc()"></div>
                <div class="input-group">
                    <label>初始投资期 / IIP (Years)</label>
                    <select id="iip" onchange="calc()">
                        <option value="10" selected>10 Years</option>
                        <option value="15">15 Years</option>
                        <option value="20">20 Years</option>
                    </select>
                </div>
                <div class="input-group"><label>停止缴费年份 / Stop Premium Year</label><input type="number" id="stopYear" value="40" min="1" oninput="calc()"></div>
                <div class="input-group">
                    <label>分红策略 / Dividend Strategy</label>
                    <select id="strat" onchange="toggleInputs();">
                        <option value="reinvest">再投资 (累计) / Reinvest All</option>
                        <option value="cash">即刻提取现金 / Immediate Income</option>
                        <option value="switch">累计后切换分红 / Accumulate then Income</option>
                    </select>
                </div>
                <div id="switchYearGroup" class="input-group hidden">
                    <label style="color:#fbc02d">切换年份 / Switch to Income at Year</label>
                    <input type="number" id="switchYear" value="21" min="1" oninput="calc()">
                </div>
            </div>

            <div class="market-box">
                <label class="cn-sub">2. 市场假设 / Market Scenarios</label>
                <div class="input-group"><label>总增长率 / Gross Growth (%)</label><input type="number" id="rIn" value="8" oninput="calc()"></div>
                <div class="input-group hidden" id="divGroup"><label>预期分红率 (AGDIF) / Div. Yield (%)</label><input type="number" id="dIn" value="5.50" step="0.1" oninput="calc()"></div>
                <div class="input-group"><label>演示年限 / Analysis Duration</label><input type="number" id="tIn" value="40" oninput="calc()"></div>
                <hr style="border:0; border-top:1px solid #d31145; opacity:0.2; margin:10px 0;">
                <label class="check-group">
                    <input type="checkbox" id="enableComp" onchange="toggleInputs()"> 开启对比模式 / Enable Comparison
                </label>
                <div id="compSettings" class="hidden" style="margin-top:10px;">
                    <div class="input-group">
                        <label style="color:#2c3e50">对比利率 / Comp. Rate (e.g. FD %)</label>
                        <input type="number" id="compRate" value="1.5" step="0.1" oninput="calc()">
                    </div>
                </div>
            </div>
        </div>

        <div class="stats-bar" id="statsBar">
            <div class="stat-card"><span class="cn-sub">总已付保费</span>Total Outlay<span class="stat-val" id="sOut">$0</span></div>
            <div class="stat-card"><span class="cn-sub">保单价值</span>Policy Value<span class="stat-val" id="sVal">$0</span></div>
            <div class="stat-card" id="divStatCard"><span class="cn-sub">累计分红</span>Total Div.<span class="stat-val" id="sCash">$0</span></div>
            <div class="stat-card"><span class="cn-sub">总利益</span>Total Benefit<span class="stat-val" id="sTot">$0</span></div>
            <div class="stat-card"><span class="cn-sub">总回报率</span>Total Return<span class="stat-val" id="sReturn">0%</span></div>
            <div class="stat-card" id="advStatCard" style="background:#1e272e; border-bottom:3px solid #2ecc71"><span class="cn-sub">额外收益</span>Accum. Advantage<span class="stat-val" id="sAdv" style="color:#2ecc71">$0</span></div>
        </div>

        <canvas id="mainChart" style="max-height: 280px; margin-bottom: 20px;"></canvas>

        <table id="mainTable">
            <thead>
                <tr id="tableHeaderRow">
                    <th>年份 / 年龄<br>Year / Age</th>
                    <th>缴付保费<br>Premium</th>
                    <th>迎新奖金<br>Welcome Bonus</th>
                    <th>特别奖金<br>Special Bonus</th>
                    <th>费用<br>Charges</th>
                    <th class="div-col hidden">当年分红<br>Yearly Div.</th>
                    <th>保单价值<br>Policy Value</th>
                    <th>总利益<br>Total Benefit</th>
                    <th id="compHeader" class="comp-col hidden">对比场景<br>Comp. Value</th>
                    <th>回报率 %<br>Return %</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>

        <div class="disclaimer">
            <strong>一般免责声明 / General Disclaimer:</strong><br>
            本演示仅供参考。实际数据将根据市场表现而有所不同。请参阅保险合同了解完整条款。<br>
            This is for illustration purposes only. Comparison scenarios (if enabled) assume constant rates. Refer to contract.
        </div>
    </div>
</div>

<script>
    const SECRET_CODE = "wesion7";
    function init() { if (document.getElementById('authOverlay').style.display === 'none') toggleInputs(); }
    function checkPass() {
        if (document.getElementById('passInput').value === SECRET_CODE) {
            document.getElementById('authOverlay').style.display = 'none';
            document.getElementById('mainCard').classList.remove('hidden');
            toggleInputs();
        } else { document.getElementById('errorMsg').style.visibility = 'visible'; }
    }
    document.getElementById('passInput').addEventListener('keypress', e => { if (e.key === 'Enter') checkPass(); });

    function toggleInputs() {
        const strat = document.getElementById('strat').value;
        const isDivActive = strat !== 'reinvest';
        const isCompActive = document.getElementById('enableComp').checked;

        document.getElementById('switchYearGroup').classList.toggle('hidden', strat !== 'switch');
        document.getElementById('divGroup').classList.toggle('hidden', !isDivActive);
        document.getElementById('divStatCard').classList.toggle('hidden', !isDivActive);
        document.getElementById('compSettings').classList.toggle('hidden', !isCompActive);
        document.getElementById('advStatCard').classList.toggle('hidden', !isCompActive);
        document.getElementById('compHeader').classList.toggle('hidden', !isCompActive);
        
        document.querySelectorAll('.div-col').forEach(el => el.classList.toggle('hidden', !isDivActive));
        
        // Dynamic Grid Sizing
        let columns = 4;
        if (isDivActive) columns++;
        if (isCompActive) columns++;
        document.getElementById('statsBar').style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
        
        calc();
    }

    function clearData() {
        document.getElementById('clientName').value = "VALUED CLIENT";
        document.getElementById('pIn').value = 12000;
        document.getElementById('ageIn').value = 40;
        document.getElementById('iip').value = 10;
        document.getElementById('stopYear').value = 40;
        document.getElementById('strat').value = "reinvest";
        document.getElementById('rIn').value = 8;
        document.getElementById('dIn').value = 5.50;
        document.getElementById('tIn').value = 40;
        document.getElementById('enableComp').checked = false;
        document.getElementById('compRate').value = 1.5;
        toggleInputs();
    }

    function getWelcomeBonusRate(premium, iip, year) {
        if (year > 3) return 0;
        if (iip == 10) {
            if (premium >= 12000) return [0.15, 0.18, 0.20][year-1];
            if (premium >= 7200) return [0.10, 0.13, 0.15][year-1];
            return year === 1 ? 0.05 : 0;
        } else if (iip == 15) {
            if (premium >= 12000) return [0.18, 0.21, 0.24][year-1];
            if (premium >= 7200) return [0.13, 0.16, 0.19][year-1];
            return year === 1 ? 0.08 : 0;
        } else {
            if (premium >= 12000) return [0.20, 0.25, 0.30][year-1];
            if (premium >= 7200) return [0.15, 0.20, 0.25][year-1];
            return year === 1 ? 0.10 : 0;
        }
    }

    function roundDown100(val) { return Math.floor(val / 100) * 100; }

    function calc() {
        const pOrig = parseFloat(document.getElementById('pIn').value) || 0;
        const startAge = parseInt(document.getElementById('ageIn').value) || 0;
        const iip = parseInt(document.getElementById('iip').value);
        const stopY = parseInt(document.getElementById('stopYear').value) || 999;
        const netR = (parseFloat(document.getElementById('rIn').value) / 100) - 0.015;
        const strat = document.getElementById('strat').value;
        const sYearInput = parseInt(document.getElementById('switchYear').value) || 21;
        const divRate = parseFloat(document.getElementById('dIn').value) / 100;
        const duration = parseInt(document.getElementById('tIn').value) || 40;
        const isCompActive = document.getElementById('enableComp').checked;
        const cRate = parseFloat(document.getElementById('compRate').value) / 100;

        let labels = [], pVals = [], tBenefits = [], outlays = [], compVals = [];
        let curV = 0, tPaid = 0, tCash = 0, curComp = 0, h = "";
        let splitPoint = -1;

        for (let y = 1; y <= duration; y++) {
            let isPay = y <= stopY;
            let currentP = isPay ? pOrig : 0;
            tPaid += currentP; curV += currentP;
            curComp = (curComp + currentP) * (1 + cRate);

            let wb = isPay ? roundDown100(pOrig * getWelcomeBonusRate(pOrig, iip, y)) : 0;
            let sb = 0;
            if (isPay) {
                if (y >= 10 && y <= 20) sb = roundDown100(pOrig * 0.05);
                else if (y >= 21) sb = roundDown100(pOrig * 0.08);
            }
            curV += (wb + sb);
            let sc = (y <= 10) ? Math.ceil(curV * 0.039) : 0;
            let phc = (!isPay && y <= iip) ? Math.ceil(pOrig * 0.05) : 0;
            curV = Math.floor((curV - (sc + phc)) * (1 + netR));

            let yDiv = 0;
            let sDivY = (strat === 'cash') ? 1 : (strat === 'switch' ? sYearInput : 999);
            if (y >= sDivY) {
                yDiv = roundDown100(curV * divRate); curV -= yDiv; tCash += yDiv;
                if (yDiv > 0 && splitPoint === -1) splitPoint = y - 1;
            }

            let dPV = roundDown100(curV), dTB = roundDown100(curV + tCash), dComp = roundDown100(curComp);
            labels.push("Y" + y); pVals.push(dPV); tBenefits.push(dTB); outlays.push(tPaid); compVals.push(dComp);

            h += `<tr>
                <td>${y} / ${startAge + y}</td>
                <td>$${currentP.toLocaleString()}</td>
                <td style="color:green">$${wb.toLocaleString()}</td>
                <td style="color:blue">$${sb.toLocaleString()}</td>
                <td style="color:red">-$${(sc + phc).toLocaleString()}</td>
                ${strat !== 'reinvest' ? `<td style="color:#2ecc71">$${yDiv.toLocaleString()}</td>` : ''}
                <td style="font-weight:bold">$${dPV.toLocaleString()}</td>
                <td class="total-row">$${dTB.toLocaleString()}</td>
                ${isCompActive ? `<td class="comp-col">$${dComp.toLocaleString()}</td>` : ''}
                <td class="return-col">${tPaid > 0 ? ((dTB / tPaid) * 100).toFixed(0) : 0}%</td>
            </tr>`;
        }

        document.getElementById('tableBody').innerHTML = h;
        document.getElementById('sOut').innerText = "$" + tPaid.toLocaleString();
        document.getElementById('sVal').innerText = "$" + pVals[duration-1].toLocaleString();
        document.getElementById('sTot').innerText = "$" + tBenefits[duration-1].toLocaleString();
        document.getElementById('sCash').innerText = "$" + tCash.toLocaleString();
        document.getElementById('sReturn').innerText = (tPaid > 0 ? ((tBenefits[duration-1] / tPaid) * 100).toFixed(0) : 0) + "%";
        document.getElementById('sAdv').innerText = "$" + (tBenefits[duration-1] - compVals[duration-1]).toLocaleString();
        if(isCompActive) document.getElementById('compHeader').innerText = `对比 (${(cRate*100).toFixed(1)}%)\nComp. Value`;

        const ctx = document.getElementById('mainChart').getContext('2d');
        if (window.myChart) window.myChart.destroy();
        
        let datasets = [
            { label: 'Total Benefit', data: tBenefits, borderColor: '#2ecc71', backgroundColor: 'rgba(46, 204, 113, 0.1)', fill: true, tension: 0.1 },
            { label: 'Total Outlay', data: outlays, borderColor: '#95a5a6', borderDash: [5, 5], fill: false, tension: 0 }
        ];

        if (isCompActive) {
            datasets.push({ label: `Comparison (${(cRate*100).toFixed(1)}%)`, data: compVals, borderColor: '#3498db', borderDash: [2, 2], fill: false, tension: 0.1 });
        }

        if (splitPoint !== -1) {
            let processedPV = pVals.map((val, idx) => (idx < splitPoint) ? null : val);
            datasets.splice(1, 0, { label: 'Policy Value', data: processedPV, borderColor: '#d31145', fill: false, tension: 0.1, spanGaps: false });
        }

        window.myChart = new Chart(ctx, {
            type: 'line',
            data: { labels: labels, datasets: datasets },
            options: { 
                responsive: true, maintainAspectRatio: false, animation: false,
                plugins: { tooltip: { mode: 'index', intersect: false, callbacks: { label: c => (c.parsed.y === null ? null : c.dataset.label + ': $' + c.parsed.y.toLocaleString()) } } },
                scales: { y: { ticks: { callback: v => '$' + v.toLocaleString() } } }
            }
        });
    }

    function downloadPDF() {
        html2pdf().set({ margin: 0.5, filename: `ProAchiever3.0_Report.pdf`, html2canvas: { scale: 2 }, jsPDF: { format: 'a4', orientation: 'landscape' } }).from(document.getElementById('pdfContent')).save();
    }
</script>
</body>
</html>